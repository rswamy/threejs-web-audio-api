<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>THREEjs Web Audio Starter</title>
</head>
<body>

<!-- Disgusting script to prevent Chrome from outputting an interruption when the mouse scrolls -->
<!-- https://stackoverflow.com/questions/55955171/preventing-unable-to-preventdefault-inside-passive-event-listener-error-within -->
<script>

	const eventListenerOptionsSupported = () => {
		let supported = false;

		try {
			const opts = Object.defineProperty({}, 'passive', {
				get() {
					supported = true;
				}
			});

			window.addEventListener('test', null, opts);
			window.removeEventListener('test', null, opts);
		} catch (e) {}

		return supported;
	}

	const defaultOptions = {
		passive: false,
		capture: false
	};
	const supportedPassiveTypes = [
		'scroll', 'wheel',
		'touchstart', 'touchmove', 'touchenter', 'touchend', 'touchleave',
		'mouseout', 'mouseleave', 'mouseup', 'mousedown', 'mousemove', 'mouseenter', 'mousewheel', 'mouseover'
	];
	const getDefaultPassiveOption = (passive, eventName) => {
		if (passive !== undefined) return passive;

		return supportedPassiveTypes.indexOf(eventName) === -1 ? false : defaultOptions.passive;
	};

	const getWritableOptions = (options) => {
		const passiveDescriptor = Object.getOwnPropertyDescriptor(options, 'passive');

		return passiveDescriptor && passiveDescriptor.writable !== true && passiveDescriptor.set === undefined
			? Object.assign({}, options)
			: options;
	};

	const overwriteAddEvent = (superMethod) => {
		EventTarget.prototype.addEventListener = function (type, listener, options) {
			const usesListenerOptions = typeof options === 'object' && options !== null;
			const useCapture          = usesListenerOptions ? options.capture : options;

			options         = usesListenerOptions ? getWritableOptions(options) : {};
			options.passive = getDefaultPassiveOption(options.passive, type);
			options.capture = useCapture === undefined ? defaultOptions.capture : useCapture;

			superMethod.call(this, type, listener, options);
		};

		EventTarget.prototype.addEventListener._original = superMethod;
	};

	const supportsPassive = eventListenerOptionsSupported();

	if (supportsPassive) {
		const addEvent = EventTarget.prototype.addEventListener;
		overwriteAddEvent(addEvent);
	}


</script>


<script id="vertexShader" type="x-shader/x-vertex">
			varying vec2 vUv;
			void main()	{
				vUv = uv;
				gl_Position = vec4( position, 1.0 );
			}
		</script>

<script id="fragmentShader" type="x-shader/x-fragment">
			varying vec2 vUv;
			uniform float time;
			void main()	{
				vec2 p = - 1.0 + 2.0 * vUv;
				float a = time * 40.0;
				float d, e, f, g = 1.0 / 40.0 ,h ,i ,r ,q;
				e = 400.0 * ( p.x * 0.5 + 0.5 );
				f = 400.0 * ( p.y * 0.5 + 0.5 );
				i = 200.0 + sin( e * g + a / 150.0 ) * 20.0;
				d = 200.0 + cos( f * g / 2.0 ) * 18.0 + cos( e * g ) * 7.0;
				r = sqrt( pow( abs( i - e ), 2.0 ) + pow( abs( d - f ), 2.0 ) );
				q = f / r;
				e = ( r * cos( q ) ) - a / 2.0;
				f = ( r * sin( q ) ) - a / 2.0;
				d = sin( e * g ) * 176.0 + sin( e * g ) * 164.0 + r;
				h = ( ( f + d ) + a / 2.0 ) * g;
				i = cos( h + r * p.x / 1.3 ) * ( e + e + a ) + cos( q * g * 6.0 ) * ( r + h / 3.0 );
				h = sin( f * g ) * 144.0 - sin( e * g ) * 212.0 * p.x;
				h = ( h + ( f - e ) * q + sin( r - ( a + h ) / 7.0 ) * 10.0 + i / 4.0 ) * g;
				i += cos( h * 2.3 * sin( a / 350.0 - q ) ) * 184.0 * sin( q - ( r * 4.3 + a / 12.0 ) * g ) + tan( r * g + h ) * 184.0 * cos( r * g + h );
				i = mod( i / 5.6, 256.0 ) / 64.0;
				if ( i < 0.0 ) i += 4.0;
				if ( i >= 2.0 ) i = 4.0 - i;
				d = r / 350.0;
				d += sin( d * d * 8.0 ) * 0.52;
				f = ( sin( a * g ) + 1.0 ) / 2.0;
				gl_FragColor = vec4( vec3( f * i / 1.6, i / 2.0 + d / 13.0, i ) * d * p.x + vec3( i / 1.3 + d / 8.0, i / 2.0 + d / 18.0, i ) * d * ( 1.0 - p.x ), 1.0 );
			}
		</script>

  <div id="debug">
    <canvas id="debug-canvas" width="245" height="140"></canvas>
  </div>
  <div id="scene2D"></div>
  <div id="scene"></div>

  <div id="video-player" class="fullscreen-bg">
      <video class="fullscreen-bg__video" muted autoplay loop>
          <source src="video/ambient.mp4" type="video/mp4">
      </video>
      <div class="fullscreen-bg__playlist">
          <a href="video/ambient.mp4" class="current-video"></a>
          <a href="video/3dfractal.mp4"></a>
          <!--<a href="video/animatedClouds.mp4"></a>-->
          <a href="video/bilousby.mp4"></a>
          <a href="video/blackTriangles.mp4"></a>
          <a href="video/bgk1.mp4"></a>
          <a href="video/bgk2.mp4"></a>
          <a href="video/bgk3.mp4"></a>
          <a href="video/bokeh.mp4"></a>
          <a href="video/bubbles.mp4"></a>
          <a href="video/bwmove.mp4"></a>
          <a href="video/clouds.mp4"></a>
          <a href="video/clouds1.mp4"></a>
          <a href="video/clouds2.mp4"></a>
          <a href="video/clouds3.mp4"></a>
          <a href="video/clouds4.mp4"></a>
          <a href="video/clouds6.mp4"></a>
          <a href="video/clouds7.mp4"></a>
          <a href="video/connect.mp4"></a>
          <a href="video/darkness1.mp4"></a>
          <a href="video/energy.mp4"></a>
          <a href="video/exhaust.mp4"></a>
          <a href="video/fastshards.mp4"></a>
          <a href="video/flyup.mp4"></a>
          <!--<a href="video/greywaves.mp4"></a>-->
          <a href="video/inkinwater.mp4"></a>
          <a href="video/jellyfish1.mp4"></a>
          <a href="video/kaleigrid.mp4"></a>
          <a href="video/multi-turbs.mp4"></a>
          <a href="video/netenergy.mp4"></a>
          <a href="video/out.mp4"></a>
          <a href="video/plexus.mp4"></a>
          <a href="video/smoke.mp4"></a>
          <a href="video/snow.mp4"></a>
          <a href="video/tanglednets.mp4"></a>
          <a href="video/thunder2.mp4"></a>
          <a href="video/triangles2.mp4"></a>
          <a href="video/triangles3.mp4"></a>
          <a href="video/water1.mp4"></a>
          <a href="video/water2.mp4"></a>
          <a href="video/waves1.mp4"></a>
          <a href="video/waves2.mp4"></a>
          <a href="video/waves3.mp4"></a>
          <a href="video/waves4.mp4"></a>
          <a href="video/wrmmm.mp4"></a>
      </div>
  </div>

  <script src="./bundle.js" type="text/javascript"></script>

</body>
</html>
